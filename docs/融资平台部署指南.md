# EON Protocol 融资平台部署指南

## 项目结构

```
eonweb/
├── config/
│   └── database.js          # 数据库配置
├── models/
│   ├── index.js             # 模型索引和关联
│   ├── User.js              # 用户模型
│   ├── Company.js           # 企业模型
│   ├── FundraisingInfo.js   # 融资信息模型
│   ├── Document.js          # 文档模型
│   ├── InvestorProfile.js   # 投资人资料模型
│   └── AccessRequest.js     # 访问请求模型
├── routes/
│   ├── auth.js              # 认证路由
│   ├── company.js           # 企业路由
│   ├── investor.js          # 投资人路由
│   └── admin.js             # 管理后台路由
├── middleware/
│   └── auth.js              # 认证中间件
├── public/
│   ├── company/
│   │   └── index.html       # 企业门户
│   ├── investor/
│   │   └── index.html       # 投资人门户
│   ├── admin/
│   │   └── fundraising.html # 融资平台管理后台
│   └── auth/
│       ├── login.html       # 登录页面
│       └── register.html    # 注册页面
├── scripts/
│   └── init-db.js           # 数据库初始化脚本
└── uploads/                 # 上传文件目录
```

## 部署到 Railway

### 1. 创建 PostgreSQL 数据库

在 Railway 控制台：
1. 点击 "New" -> "Database" -> "PostgreSQL"
2. 等待数据库创建完成
3. 复制 `DATABASE_URL` 连接字符串

### 2. 配置环境变量

在 Railway 项目设置中添加以下环境变量：

```
DATABASE_URL=postgresql://... (从 PostgreSQL 服务复制)
JWT_SECRET=your-super-secret-key-change-this
ADMIN_EMAIL=admin@yourdomain.com
ADMIN_PASSWORD=your-secure-password
NODE_ENV=production
```

### 3. 部署应用

方式一：通过 GitHub 连接
1. 将代码推送到 GitHub
2. 在 Railway 中连接 GitHub 仓库
3. 选择分支并部署

方式二：通过 Railway CLI
```bash
# 安装 Railway CLI
npm install -g @railway/cli

# 登录
railway login

# 连接项目
railway link

# 部署
railway up
```

### 4. 初始化数据库

部署成功后，运行初始化脚本：

```bash
# 通过 Railway CLI 运行
railway run npm run init-db
```

或者在 Railway 控制台的 Shell 中运行：
```bash
npm run init-db
```

## 访问入口

部署完成后，可以通过以下路径访问：

- **企业门户**: `https://your-domain.railway.app/company`
- **投资人门户**: `https://your-domain.railway.app/investor`
- **管理后台**: `https://your-domain.railway.app/admin/fundraising.html`
- **注册页面**: `https://your-domain.railway.app/auth/register.html`
- **登录页面**: `https://your-domain.railway.app/auth/login.html`

## API 端点

### 认证 API
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/me` - 获取当前用户信息

### 企业 API
- `GET /api/company/profile` - 获取企业资料
- `POST /api/company/profile` - 创建/更新企业资料
- `POST /api/company/fundraising` - 保存融资信息
- `POST /api/company/upload-bp` - 上传 BP 文件
- `POST /api/company/submit` - 提交审核

### 投资人 API
- `GET /api/investor/profile` - 获取投资人资料
- `POST /api/investor/profile` - 保存投资人资料
- `GET /api/investor/projects` - 浏览项目列表
- `GET /api/investor/projects/:id` - 获取项目详情
- `POST /api/investor/request-access` - 请求访问权限

### 管理后台 API
- `GET /api/admin/stats` - 获取统计数据
- `GET /api/admin/companies` - 企业列表
- `PUT /api/admin/companies/:id/review` - 审核企业
- `GET /api/admin/investors` - 投资人列表
- `PUT /api/admin/investors/:id/review` - 审核投资人
- `GET /api/admin/requests` - 访问请求列表
- `PUT /api/admin/requests/:id` - 处理请求

## 角色权限

| 角色 | 权限 |
|------|------|
| company | 企业用户，可以提交企业信息和融资需求 |
| investor | 投资人，可以浏览项目和请求引荐 |
| admin | 管理员，可以审核企业、投资人和处理请求 |

## 数据模型

### 用户 (User)
- 支持三种角色：company, investor, admin
- 密码使用 bcrypt 加密存储

### 企业 (Company)
- 包含基本信息、行业、阶段、联系人等
- 状态：draft, pending, approved, rejected
- 可见性：private, investors, whitelist

### 融资信息 (FundraisingInfo)
- 关联企业
- 包含融资目的、类型、金额、时间窗口等

### 文档 (Document)
- 支持 BP、财务、法律等类型文件
- 支持访问控制

### 投资人资料 (InvestorProfile)
- 包含投资人信息和投资偏好
- 需要管理员审核后才能浏览项目

### 访问请求 (AccessRequest)
- 投资人向企业发起的 BP 访问或引荐请求
- 由管理员处理

## 安全注意事项

1. 修改默认管理员密码
2. 设置强 JWT_SECRET
3. 启用 HTTPS
4. 定期备份数据库
5. 监控异常登录行为
